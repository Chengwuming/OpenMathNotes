<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="../css/styles.css" rel="stylesheet" />
    <title>笔记更新记录</title>
    <style>
        /* 其他样式保持不变 */

        /* 背景图片 */
        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 320vh;
            background: url('../assets/img/111.jfif') no-repeat center center;
            background-size: cover;
            z-index: -1;
            transition: transform 0.5s ease-out;
        }

        /* 其他样式保持不变 */
    </style>
</head>
<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="../index.html">Ciallo～(∠・ω< )⌒☆</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../Notes/分析/常微分方程/ode-notes-1.html">Notes</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../edited-latex.html">Posts</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../Notes/notes-update.html">Logs</a></li>
                    <!--li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="contact.html">Contact</a></li-->
                </ul>
            </div>  
        </div>
    </nav>

    <div class="background-image" id="background-image"></div>

    <div class="timeline" id="timeline-container"></div>
    <button id="toggle-button" style="display: none;">展开更多</button>

    <script>
        async function fetchRSS() {
            try {
                const response = await fetch('lib/rss.xml'); // 修改这里为您的RSS文件路径
                const text = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(text, 'text/xml');

                const items = Array.from(xmlDoc.querySelectorAll('item'));

                // 按发布日期排序（降序）
                items.sort((a, b) => {
                    const dateA = new Date(a.querySelector('pubDate').textContent);
                    const dateB = new Date(b.querySelector('pubDate').textContent);
                    return dateB - dateA;
                });

                // 按日期分组
                const groupedItems = items.reduce((groups, item) => {
                    const pubDate = new Date(item.querySelector('pubDate').textContent);
                    const dateKey = pubDate.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
                    if (!groups[dateKey]) {
                        groups[dateKey] = [];
                    }
                    groups[dateKey].push(item);
                    return groups;
                }, {});

                const timelineContainer = document.getElementById('timeline-container');
                const toggleButton = document.getElementById('toggle-button');
                let visibleCount = 5; // 初始显示的条目数量

                for (const [date, items] of Object.entries(groupedItems)) {
                    const timelineEntry = document.createElement('div');
                    timelineEntry.className = 'timeline-entry';

                    const timelineContent = document.createElement('div');
                    timelineContent.className = 'timeline-content';

                    const timelineDate = document.createElement('div');
                    timelineDate.className = 'timeline-date';
                    timelineDate.textContent = date;

                    timelineContent.appendChild(timelineDate);

                    items.forEach(item => {
                        const title = item.querySelector('title').textContent;
                        const link = item.querySelector('link').textContent;
                        const description = item.querySelector('description').textContent;

                        // 提取预览内容
                        const previewMatch = description.match(/"(.*?)"/);
                        const previewContent = previewMatch ? previewMatch[1].trim() : '无预览内容';

                        const record = document.createElement('div');
                        record.className = 'record';

                        const recordTitle = document.createElement('p');
                        recordTitle.className = 'record-title';
                        const recordLink = document.createElement('a');
                        recordLink.href = link;
                        recordLink.textContent = title;
                        recordLink.target = '_blank'; // 新标签打开
                        recordTitle.appendChild(recordLink);

                        const recordDescription = document.createElement('p');
                        recordDescription.className = 'record-description';
                        recordDescription.textContent = previewContent;

                        record.appendChild(recordTitle);
                        record.appendChild(recordDescription);

                        timelineContent.appendChild(record);
                    });

                    timelineEntry.appendChild(timelineContent);
                    timelineContainer.appendChild(timelineEntry);
                }

                // 折迭多余的条目
                const timelineEntries = timelineContainer.querySelectorAll('.timeline-entry');
                timelineEntries.forEach((entry, index) => {
                    if (index >= visibleCount) {
                        entry.style.display = 'none';
                    }
                });

                // 如果条目数量超过 visibleCount，显示按钮
                if (timelineEntries.length > visibleCount) {
                    toggleButton.style.display = 'block';
                }

                // 按钮点击事件处理函数
                toggleButton.addEventListener('click', () => {
                    timelineEntries.forEach((entry, index) => {
                        if (index >= visibleCount) {
                            entry.style.display = entry.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                    toggleButton.textContent = toggleButton.textContent === '展开更多' ? '收起' : '展开更多';
                });
            } catch (error) {
                console.error('Error fetching or parsing RSS:', error);
                const timelineContainer = document.getElementById('timeline-container');
                timelineContainer.textContent = '无法加载更新记录。';
            }
        }

        // 在页面加载完成后调用fetchRSS
        window.addEventListener('DOMContentLoaded', fetchRSS);

        // 监听滚动事件，调整背景图片的滚动速度
        window.addEventListener('scroll', () => {
            const backgroundImage = document.getElementById('background-image');
            const scrollTop = window.scrollY;
            const scrollSpeed = -0.5; // 调整背景图片的滚动速度为负数
            const maxScroll = backgroundImage.clientHeight - window.innerHeight;

            if (scrollTop <= maxScroll) {
                backgroundImage.style.transform = `translateY(${scrollTop * scrollSpeed}px)`;
            } else {
                backgroundImage.style.transform = `translateY(${maxScroll * scrollSpeed}px)`;
            }
        });
    </script>
</body>
</html>